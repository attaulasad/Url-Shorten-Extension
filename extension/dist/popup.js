(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function l(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(e){if(e.ep)return;e.ep=!0;const t=l(e);fetch(e.href,t)}})();document.addEventListener("DOMContentLoaded",()=>{const i=document.querySelectorAll(".tab-btn"),c=document.querySelectorAll(".tab-content");function l(e){i.forEach(t=>t.classList.remove("active")),c.forEach(t=>t.classList.remove("active")),document.getElementById(e).classList.add("active"),document.querySelector(`.tab-btn[data-tab="${e}"]`).classList.add("active"),e==="history"&&a()}i.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-tab");l(t)})}),document.getElementById("login-form").addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("login-username").value,s=document.getElementById("login-password").value,o=document.getElementById("login-TMZ");try{const n=await fetch("http://localhost:5000/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:s})}),r=await n.json();n.ok?chrome.storage.local.set({token:r.token},()=>{o.textContent="Login successful!",o.style.color="green",l("shorten")}):(o.textContent=r.message||"Login failed",o.style.color="red")}catch(n){o.textContent="Error: "+n.message,o.style.color="red"}}),document.getElementById("signup-form").addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("signup-username").value,s=document.getElementById("signup-password").value,o=document.getElementById("signup-message");try{const n=await fetch("http://localhost:5000/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:s})}),r=await n.json();n.ok?(o.textContent="Signup successful! Please log in.",o.style.color="green",l("login")):(o.textContent=r.message||"Signup failed",o.style.color="red")}catch(n){o.textContent="Error: "+n.message,o.style.color="red"}}),document.getElementById("shorten-form").addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("long-url").value,s=document.getElementById("short-url"),o=document.getElementById("copy-btn");try{const n=await new Promise(m=>{chrome.storage.local.get("token",g=>m(g.token))}),r={"Content-Type":"application/json"};n&&(r.Authorization=`Bearer ${n}`);const d=await fetch("http://localhost:5000/shorten",{method:"POST",headers:r,body:JSON.stringify({long_url:t})}),u=await d.json();d.ok?(s.textContent=u.short_url,s.style.color="black",o.style.display="block"):(s.textContent=u.message||"Failed to shorten URL",s.style.color="red",o.style.display="none")}catch(n){s.textContent="Error: "+n.message,s.style.color="red",o.style.display="none"}}),document.getElementById("copy-btn").addEventListener("click",()=>{const e=document.getElementById("short-url").textContent;navigator.clipboard.writeText(e).then(()=>{alert("Copied to clipboard!")})});async function a(){const e=document.getElementById("url-list");e.innerHTML="";try{const t=await new Promise(n=>{chrome.storage.local.get("token",r=>n(r.token))});if(!t){e.innerHTML="<li>Please log in to view history</li>";return}const s=await fetch("http://localhost:5000/urls",{headers:{Authorization:`Bearer ${t}`}}),o=await s.json();s.ok?(o.urls.forEach(n=>{const r=document.createElement("li");r.textContent=`${n.short_code}: ${n.long_url}`,e.appendChild(r)}),o.urls.length===0&&(e.innerHTML="<li>No URLs found</li>")):e.innerHTML="<li>Error: "+o.message+"</li>"}catch(t){e.innerHTML="<li>Error: "+t.message+"</li>"}}l("login")});
